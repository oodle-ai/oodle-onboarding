sources:
  docker_logs:
    type: docker_logs
    docker_host: unix:///var/run/docker.sock
    include_containers:
      - demo-app

transforms:
  parse_json:
    type: remap
    inputs:
      - docker_logs
    source: |
      . = parse_json!(.message)

  add_timestamp:
    type: remap
    inputs:
      - parse_json
    source: |
      # Add @timestamp field for OpenSearch Dashboards
      .@timestamp = .timestamp

sinks:
  opensearch:
    type: elasticsearch
    inputs:
      - add_timestamp
    endpoints:
      - http://opensearch:9200
    mode: bulk
    bulk:
      index: logs-%Y.%m.%d
    compression: none
    healthcheck:
      enabled: true
